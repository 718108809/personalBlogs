# 开发规范

### 一、为什么需要 “前端开发规范”？

 规范不是强制性的，对代码的编写和程序的运行不会有致命的问题，但是没有规范会有一系列的问题，比如：

- 缺乏规范，第一个问题就是团队编码风格不一，增加了成员之间代码的阅读成本，加大了团队协作成本和维护成本；
- 随着团队人员的变化（多人开发一个应用，或者应用更换开发人员），如果缺乏规范，项目可能会变得一团糟，甚至失控；
- 即便是个人开发，规范也是需要的，当把项目转给其他人的时候，如果有规范的话，会大大降低阅读成本；

### 二、开发格式规范

 项目中统一使用标准的.prettierrc 文件配置，使用 VScode 编辑开发，需要下载 Prettier - Code formatter 插件，同时配置设置中的 Format On Save 为开启状态；

### 三、css 公共样式规范

 项目中采用 less 作为预编译语言,项目中基础组件应当保持相同的样式，所以对目前项目中的公共样式做出如下要求

- 需要采用 dt-开头 例如 dt-select， dt-input 等

  > 如果有相同组件样式不同,可以在自己模块的 css 中层叠掉，如果设计稿中的样子两处相同组件样式不一致，与 UI 核对后，做出相应更改，如果都是一样的样式，请修改公共样式。
  >

### 四、组件开发封装规范

 项目中，对可复用性组件应当做出封装，封装的目的在于后期维护以及拓展。一般来说，同一个组件，会在两个以上的地方使用时，我们就应当做出封装，当下次需求发生变更时，我们只用更改基础组件，参与业务类型的组件都会发生变更。

> 例如在vue项目中，select样式不符合UI设计，需要调整样式，以及部分业务代码，因为select是常用类型组件，我们就应当对select做出二次封装，满足项目需求。其他地方有引用select组件，需要引入二次封装的组件去使用，后期因为样式调整或业务变更，只用修改二次封装的公共组件即可，这样大量节省了后期代码维护的时间，也加大了开发的效率；

### 五、js 脚本规范

 原则上应当使用 eslint 规范化编码，ESLint 是一个插件化的 javascript 代码检测工具，它可以用于检查常见的 JavaScript 代码错误，执行效率问题，也可以进行代码风格检查，统一代码风格。为加大脚本阅读的可读性，对 js 脚本做出以下规范。

>  以下列出的规范,绝大部分在 eslint 中已经有做出规定。有兴趣的可以参考 eslint 去规范化自己的代码，会使自己的代码更加简洁，明了

#### 命名规范

> 所有命名语义化，英文命名确保英文拼写正确；

- 常量名

  全部大写并单词间用下划线分隔

  ```js
  // 业务模型
  const BUSI_MODEL = ['animationObj', 'linkObj', 'targetObj'];
  ```
- 对象的属性或方法名

  小驼峰式（little camel-case）

  ```js
  const state = {
    selectNodes: {},
    isCreated: false,
  };
  ```
- 类名（构造器）

  - 小驼峰式但首字母大写

    ```js
    class MyComponent extends React.Component {
      constructor(props) {
        super(props)
        this.state = {
          number: 0，
        }
      }
      // 商品数量累加
      add = () => {
        this.setState({
          number: this.state.number + 1
        })
      }

      render() {
        return (
          <div className="red">
            <span>{this.state.number}</span>
            <button onClick={this.add}>+1</button>
          </div>
        )
      }
    }
    export default MyComponent;
    ```
- 函数名与变量名

  小驼峰式

  ```js
  let defaultName = '张三';
  function initEvents() {}
  ```

#### 变量声明

 变量或函数声明等，采用 ES6 语法，尽量使用 let、const 等，不要使用 var 等声明方式；

>  let 与 const 区别:
>
>  let 用于定义可以改变数值或者类型的变量
>
>  const 用于定义常量, 不会发生变更的引用数据类型

_不推荐_

```js
var str = '这是一段字符串';
let list = [
  {
    name: 'zs',
    age: 18,
  },
  {
    name: 'ls',
    age: 20,
  },
];
list[0].age = 30;

let person = {
  name: 'zs',
  age: 20,
};
person.age = 18;
```

_推荐_

```js
const str = '这是一个字符串';
// 如果str会发生变更,则应当使用let去定义
let str2 = '这是一个字符串';

const list = [
  {
    name: 'zs',
    age: 18,
  },
  {
    name: 'ls',
    age: 20,
  },
];
// 此时arr是引用数据类型,arr在内存中的地址值不会发生改变,故用const定义
list[0].age = 30;

const person = {
  name: 'zs',
  age: 20,
};
// 此时person在内存中的地址值未发生改变,只是改变了person对象中的属性,应采用const定义
person.age = 18;
```

#### 单行代码块

在单行代码块中使用空格

_不推荐_

```js
function foo() {
  return true;
}
if (foo) {
  bar = 0;
}
```

_推荐_

```js
function foo() {
  return true;
}
if (foo) {
  bar = 0;
}
```

#### 大括号风格

在编程过程中，大括号风格与缩进风格紧密联系，用来描述大括号相对代码块位置的方法有很多。在 JavaScript 中，主要有三种风格，如下：

- **One True Brace Style**

  ```js
  if (foo) {
    bar();
  } else {
    baz();
  }
  ```
- **Stroustrup**

  ```js
  if (foo) {
    bar();
  } else {
    baz();
  }
  ```
- **Allman**

  ```js
  if (foo) {
    bar();
  } else {
    baz();
  }
  ```

我们团队约定使用 `One True Brace Style` 风格

#### 变量命名

当命名变量时，主流分为驼峰式命名（constiableName）和下划线命名（constiable_name）两大阵营。

> 团队约定使用驼峰式命名

#### 拖尾逗号

在 ECMAScript5 里面，对象字面量中的拖尾逗号是合法的，但在 IE8（非 IE8 文档模式）下，当出现拖尾逗号，则会抛出错误。

拖尾逗号的例子：

```js
const foo = {
  name: 'foo',
  age: '22',
};
```

拖尾逗号的好处是，简化了对象和数组添加或删除元素，我们只需要修改新增的行即可，并不会增加差异化的代码行数。

> 因为拖尾逗号有好也有不好，所以团队约定允许在最后一个元素或属性与闭括号 `]` 或 `}` 在不同行时，可以（但不要求）使用拖尾逗号。当在同一行时，禁止使用拖尾逗号。

#### 逗号空格

逗号前后的空格可以提高代码的可读性，团队约定在逗号后面使用空格，逗号前面不加空格。

_不推荐_

```js
const foo = 1,
  bar = 2;
const foo = 1,
  bar = 2;
const foo = 1,
  bar = 2;
```

_推荐_

```js
const foo = 1,
  bar = 2;
```

#### 逗号风格

逗号分隔列表时，在 JavaScript 中主要有两种逗号风格：

- 标准风格，逗号放置在当前行的末尾
- 逗号前置风格，逗号放置在下一行的开始位置

> 团队约定使用标准风格

_不推荐_

```js
const foo = 1,
  bar = 2;

const foo = 1,
  bar = 2;

const foo = ['name', 'age'];
```

_推荐_

```js
const foo = 1,
  bar = 2;

const foo = ['name', 'age'];
```

#### 计算属性的空格

团队约定在对象的计算属性内，禁止使用空格

_不推荐_

```js
obj['foo'];
obj['foo'];
obj['foo'];
```

_推荐_

```js
obj['foo'];
```

#### 拖尾换行

在非空文件中，存在拖尾换行是一个常见的 `UNIX` 风格，它的好处是可以方便在串联和追加文件时不会打断 `Shell` 的提示。在日常的项目中，保留拖尾换行的好处是，可以减少版本控制时的代码冲突。

_不推荐_

```js
function func() {
  // do something
}
```

_推荐_

```js
function func() {
  // do something
}
// 此处是新的一行
```

> 可以通过 .editorconfig 添加 EOL

#### 函数调用

为了避免语法错误，团队约定在函数调用时，禁止使用空格

_不推荐_

```js
fn();
fn();
```

_推荐_

```js
fn();
```

#### 函数或者方法规范

>  函数体过长时，尽量考虑对函数体进行优化，选择使用多个方法并给出注释去完成业务

#### 缩进

代码保持一致的缩进，是作为工程师的职业素养。但缩进用两个空格，还是四个空格，是用 `Tab` 还是空格呢？这样的争论太多了，也得不出答案。本规范结合了市面上优秀的开源项目，姑且约定使用 `空格` 来缩进。为了方便观看观看代码，目前采用缩进四个空格。

> 项目中已经配置 `.editorconfig` ，将 `Tab` 自动转换为空格，4 个空格缩进。

#### 对象字面量的键值缩进

团队约定对象字面量的键和值之间不能存在空格，且要求对象字面量的冒号和值之间存在一个空格

_不推荐_

```js
const obj = { foo: 'haha' };
```

_推荐_

```js
const obj = { foo: 'haha' };
```

#### 构造函数首字母大写

在 JavaScript 中 `new` 操作符用来创建某个特定类型的对象的一个实例，该类型的对象是由一个构造函数表示的。由于构造函数只是常规函数，唯一区别是使用 `new` 来调用。所以我们团队约定构造函数的首字母要大小，以此来区分构造函数和普通函数。

_不推荐_

```js
const fooItem = new foo();
```

_推荐_

```js
const fooItem = new Foo();
```

#### 链式调用

链式调用如果放在同一行，往往会造成代码的可读性差，但有些时候，短的链式调用并不会影响美观。所以本规范约定一行最多只能有四个链式调用，超过就要求换行。

#### 空行

空白行对于分离代码逻辑有帮助，但过多的空行会占据屏幕的空间，影响可读性。团队约定最大连续空行数为 2

_不推荐_

```js
const a = 1;

const b = 2;
```

_推荐_

```js
const a = 1;

const b = 2;
```

#### 链式赋值

链式赋值容易造成代码的可读性差，所以团队约定禁止使用链式赋值

_不推荐_

```js
const a = (b = c = 1);
```

_推荐_

```js
const a = 1;
const b = 1;
const c = 1;
```

#### 变量声明

JavaScript 允许在一个声明中，声明多个变量。团队约定在声明变量时，一个声明只能有一个变量

_不推荐_

```js
const a, b, c
```

_推荐_

```js
const a
const b
const c
```

#### 分号

JavaScript 在所有类 C 语言中是比较独特的，它不需要在每个语句的末尾有分号。在很多情况下，JavaScript 引擎可以确定一个分号应该在什么位置然后自动添加它。此特征被称为 自动分号插入 (ASI)，被认为是 JavaScript 中较为有争议的特征。

> 为了统一规范，团队中已经使用 prettier 的一套美化规范，在.prettier 中已经配置是否结尾分号

#### 代码块空格

一致性是任何风格指南的重要组成部分。虽然在哪里放置块的开括号纯属个人偏好，但在整个项目中应该保持一致。不一致的风格将会分散读者阅读代码的注意力。

> 团队约定代码块前要添加空格

_不推荐_

```js
if (a) {
  b();
}

function a() {}
```

_推荐_

```js
if (a) {
  b();
}

function a() {}
```

#### 操作符的空格

> 团队约定操作符前后都需要添加空格

_不推荐_

```js
const sum = 1 + 2;
```

_推荐_

```js
const sum = 1 + 2;
```

### 六、注释规范

 代码注释在代码的可读性以及后期维护尤为重要，所以需要为前端代码注释制定统一的注释规范，大家有统一的约定可利于非代码书写者的阅读、修改等后续操作，以此提高代码可读性和可维护性，从而提高代码质量

#### javascript 注释规范

- 单行注释:

  >  必须独占一行。// 后跟一个空格，缩进与下一行被注释说明的代码一致，对对象的属性的注释,可在对象属性结尾处添加注释
  >

  ```js
  // 拿到list数组中的所有对象的名字
  const result = list.map((item) => item.name);
  ```
- 多行注释

  - 普通多行注释

    ```js
    /**
     * 这是一个注释
     * 这是另外一行注释
     */
    ```

    ```js
    // 这是一个注释
    // 这是另外一行注释
    ```
  - 函数多行注释

    > 函数/方法注释必须包含函数说明，有参数和返回值时必须使用注释标识，参数和返回值注释必须包含类型信息和说明；
    >

    ```
    /**
     * @desc 函数的描述
     * @param {string} p1 参数1的说明,比较长可以换行
     * @param {Boolean} p2 参数2的说明
     * @param {number=} p3 参数3的说明（可选）
     * @return {Object} 返回值描述
     */
    function foo(p1, p2, p3 = 1) {
        var p3 = p3 || 10;
        return {
            p1: p1,
            p2: p2,
            p3: p3
        };
    }
    ```

#### 开发思路文档说明

> 当开发中使用的思路较为复杂或难理解时，应当对当前的脚本同目录下创建 Readme.md 文件，对脚本思路做出说明。

### 七、提交规范

> 后面可以考虑使用 commitizen 规范化提交

- 新功能提交命名(feat 或 feature)：feat：新增基础交互事件&新增弹窗组件
- bug 修复提交命名：fix：修复了场景加载异常的问题
- 更改文件目录结构：change：更改了视图层目录结构
- 解决冲突命名：solve conflict
- 更新了说明文档或者组件功能：update：更新了项目说明文档
- 性能或代码优化: perf : 优化编辑器算法
- 代码格式变更: style: 代码缩进变更
- 构建过程或辅助工具的变动: chore：打包移除 console
