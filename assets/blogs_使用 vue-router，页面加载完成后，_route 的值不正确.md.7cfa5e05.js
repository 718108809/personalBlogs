import{_ as s,c as a,o as n,N as l}from"./chunks/framework.255dec5c.js";const o="/personalBlogs/assets/1690774163149.8ad4c30d.png",p="/personalBlogs/assets/1690774215701.528ece75.png",e="/personalBlogs/assets/1690774245601.1fa11a2b.png",t="/personalBlogs/assets/1690774258771.d634b850.png",c="data:image/png;base64,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",m=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"blogs/使用 vue-router，页面加载完成后，$route 的值不正确.md"}'),r={name:"blogs/使用 vue-router，页面加载完成后，$route 的值不正确.md"},y=l(`<h2 id="_1-问题描述" tabindex="-1">1 问题描述 <a class="header-anchor" href="#_1-问题描述" aria-label="Permalink to &quot;1 问题描述&quot;">​</a></h2><p>页面加载时，需要判断：地址能否匹配上路由。如果匹配不上，就跳转到首页。</p><p>代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">mounted</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$route</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">matched</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>问题出现了：当访问的地址可以匹配上路由时，也会跳到首页。</p><hr><h2 id="_2-找到问题" tabindex="-1">2 找到问题 <a class="header-anchor" href="#_2-找到问题" aria-label="Permalink to &quot;2 找到问题&quot;">​</a></h2><p>在 mounted 中打印 <code>$route</code>：</p><p><img src="`+o+`" alt="1690774163149"> 可以看到，所有的值都不对。最明显的是 <code>path</code> 和 <code>fullPath</code> ，明明应该有值，但现在只是一个 <code>&quot;/&quot;</code> 。</p><p>我猜测：在 mounted 中，router 的初始化还没有完成，所以取到的是一个初始默认值。</p><p>加一个延时，试一下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">mounted</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$route</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">matched</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">},</span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>延时 1000ms ，此时router 的值是对的了：</p><p><img src="`+p+`" alt="1690774215701"></p><ul><li><strong>vue-router 初始化是需要一段时间的，在完成之前，取值只能拿到初始的默认值。</strong></li><li><strong>在 mounted 中 router 初始化可能还没有完成。</strong></li></ul><hr><h2 id="_3-不能用定时器-用-onready" tabindex="-1">3 不能用定时器，用 onReady <a class="header-anchor" href="#_3-不能用定时器-用-onready" aria-label="Permalink to &quot;3 不能用定时器，用 onReady&quot;">​</a></h2><p>上面用定时器延迟了1000ms，取到了 router。但是，真正要解决这个问题，肯定不能用定时器，因为延迟的时间无法确定：</p><ul><li>长了，影响体验</li><li>短了，可能router初始化还没完成呢</li></ul><p>我去翻了官网API，希望官方提供了<strong>初始化完成时的回调方法</strong>，果然找到了：<a href="https://router.vuejs.org/zh/api/#router-onready" target="_blank" rel="noreferrer">onReady</a></p><p>代码改成：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">mounted</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onReady</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$route</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">matched</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>完美通过！</p><hr><h2 id="_4-有的同学可能会担心-onready会不会错过啊" tabindex="-1">4 有的同学可能会担心：onReady会不会错过啊？ <a class="header-anchor" href="#_4-有的同学可能会担心-onready会不会错过啊" aria-label="Permalink to &quot;4 有的同学可能会担心：onReady会不会错过啊？&quot;">​</a></h2><p>（可能只有我担心这个问题）</p><h3 id="_4-1-错过-是什么意思" tabindex="-1">4.1 “错过”是什么意思 <a class="header-anchor" href="#_4-1-错过-是什么意思" aria-label="Permalink to &quot;4.1 “错过”是什么意思&quot;">​</a></h3><p>先解释一下 “错过”。举个例子：</p><p>给 window 绑定 load 事件：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">	&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>会弹出： <img src="`+e+`" alt="1690774245601"></p><p>如果延迟一会儿，再绑定事件呢：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">	&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onload</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>这样就不会弹出了。因为延迟了2000ms 后才绑定事件。这个时候 window已经 load 完了。错过了。</p><h3 id="_4-2-onready会不会-错过-呢" tabindex="-1">4.2 onReady会不会&quot;错过&quot;呢？ <a class="header-anchor" href="#_4-2-onready会不会-错过-呢" aria-label="Permalink to &quot;4.2 onReady会不会&quot;错过&quot;呢？&quot;">​</a></h3><p>先说结论：<strong>不会！</strong></p><p>因为 window.onload 和 <a href="https://so.csdn.net/so/search?q=vue&amp;spm=1001.2101.3001.7020" target="_blank" rel="noreferrer">vue</a>-router 的 onReady 是完全不同的两种机制：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 机制一：绑定处理函数。绑定好之后，window触发load事件时，才会调用。所以存在错过的现象</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">onload </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 机制二：调用 onReady 函数！</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onReady</span><span style="color:#A6ACCD;">(cb)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">12345</span></span></code></pre></div><p>去看看 <a href="https://github.com/vuejs/vue-router/blob/dev/src/history/base.js" target="_blank" rel="noreferrer">源码</a> ，onReady 到底是做了什么：</p><p><img src="`+t+'" alt="1690774258771"></p><ul><li>如果路由已经 ready 了，就立即执行 <code>cb</code>。</li><li>如果路由还没有 ready，就把 <code>cb</code> 放到 readyCbs 中。</li></ul><p>接着看源码，发现： <img src="'+c+`" alt="1690774274662"> 上面这段代码是在初始化完成后立即调用的：修改 ready 为 true ，并执行 readyCbs 中的 cb 。</p><p>所以，onReady不会错过，放心的用！</p><h2 id="注意" tabindex="-1">注意: <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;注意:&quot;">​</a></h2><p>在vue-router@4中</p><p>请将 <code>onReady</code> 改为 <code>isReady</code></p><p>现有的 <code>router.onReady()</code> 函数已被 <code>router.isReady()</code> 取代，该函数不接受任何参数并返回一个 Promise：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 将</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onReady</span><span style="color:#A6ACCD;">(onSuccess</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> onError)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 替换成</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isReady</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(onSuccess)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(onError)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 或者使用 await:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isReady</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 成功</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#A6ACCD;"> (err) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 报错</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="所有的导航现在都是异步的" tabindex="-1"><strong>所有</strong>的导航现在都是异步的 <a class="header-anchor" href="#所有的导航现在都是异步的" aria-label="Permalink to &quot;**所有**的导航现在都是异步的&quot;">​</a></h3><p>所有的导航，包括第一个导航，现在都是异步的，这意味着，如果你使用一个 <code>transition</code>，你可能需要等待路由 <em>ready</em> 好后再挂载程序：</p><p>js</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app.use(router)</span></span>
<span class="line"><span style="color:#A6ACCD;">// 注意：在服务器端，你需要手动跳转到初始地址。</span></span>
<span class="line"><span style="color:#A6ACCD;">router.isReady().then(() =&gt; app.mount(&#39;#app&#39;))</span></span></code></pre></div><p>否则会有一个初始过渡，就像你提供了 <code>appear</code> 属性到 <code>transition</code> 一样，因为路由会显示它的初始地址（什么都没有），然后显示第一个地址。</p><p>请注意，<strong>如果在初始导航时有导航守卫</strong>，你可能不想阻止程序渲染，直到它们被解析，除非你正在进行服务器端渲染。否则，在这种情况下，不等待路由准备好挂载应用会产生与 Vue2 中相同的结果。</p><h3 id="isready" tabindex="-1">isReady <a class="header-anchor" href="#isready" aria-label="Permalink to &quot;isReady&quot;">​</a></h3><p>▸ <strong>isReady</strong>(): <code>Promise</code>&lt;<code>void</code>&gt;</p><p>返回一个 Promise，它会在路由器完成初始导航之后被解析，也就是说这时所有和初始路由有关联的异步入口钩子和异步组件都已经被解析。如果初始导航已经发生，则该 Promise 会被立刻解析。</p><p>这在服务端渲染中确认服务端和客户端输出一致的时候非常有用。注意在服务端你需要手动加入初始地址，而在客户端，路由器会从 URL 中自动获取。</p><h4 id="返回值" tabindex="-1">返回值 <a class="header-anchor" href="#返回值" aria-label="Permalink to &quot;返回值&quot;">​</a></h4><p><code>Promise</code>&lt;<code>void</code>&gt;</p><hr><p>参考：</p><ul><li><a href="https://github.com/vuejs/vue-router" target="_blank" rel="noreferrer">vue-router 的 github</a></li><li><a href="https://router.vuejs.org/zh/api/#router-link" target="_blank" rel="noreferrer">vue-router 的 API</a></li></ul>`,63),F=[y];function D(i,A,C,d,h,g){return n(),a("div",null,F)}const E=s(r,[["render",D]]);export{m as __pageData,E as default};
